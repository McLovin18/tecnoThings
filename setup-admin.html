<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crear Admin - TecnoThings</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-800 min-h-screen flex items-center justify-center p-4">

<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md">
  <h1 class="text-3xl font-bold text-center mb-2 text-gray-900 dark:text-white">üîê Crear Admin</h1>
  <p class="text-center text-gray-600 dark:text-gray-400 mb-8">Configura la cuenta de administrador</p>

  <form id="admin-form" class="space-y-4">
    <!-- Email -->
    <div>
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
        <span class="material-icons inline text-lg align-middle mr-2">mail</span>
        Correo Electr√≥nico
      </label>
      <input 
        type="email" 
        id="email" 
        placeholder="admin@tecnothings.com"
        class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focused:outline-none dark:text-white"
        required
      />
    </div>

    <!-- Nombre -->
    <div>
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
        <span class="material-icons inline text-lg align-middle mr-2">person</span>
        Nombre Completo
      </label>
      <input 
        type="text" 
        id="name" 
        placeholder="Administrador"
        class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focused:outline-none dark:text-white"
        required
      />
    </div>

    <!-- Contrase√±a -->
    <div>
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
        <span class="material-icons inline text-lg align-middle mr-2">lock</span>
        Contrase√±a
      </label>
      <input 
        type="password" 
        id="password" 
        placeholder="M√≠nimo 6 caracteres"
        class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focused:outline-none dark:text-white"
        required
        minlength="6"
      />
    </div>

    <!-- Confirmar Contrase√±a -->
    <div>
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
        <span class="material-icons inline text-lg align-middle mr-2">lock</span>
        Confirmar Contrase√±a
      </label>
      <input 
        type="password" 
        id="password-confirm" 
        placeholder="Confirma la contrase√±a"
        class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focused:outline-none dark:text-white"
        required
        minlength="6"
      />
    </div>

    <!-- Mensajes -->
    <div id="message" class="p-4 rounded-lg hidden text-sm font-medium"></div>

    <!-- Bot√≥n -->
    <button 
      type="submit"
      class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2"
    >
      <span class="material-icons">person_add</span>
      Crear Admin
    </button>
  </form>

  <p class="text-center text-sm text-gray-600 dark:text-gray-400 mt-6">
    ‚ö†Ô∏è Solo ejecuta esto una vez
  </p>
</div>

<script type="module">
import { createInitialAdmin } from './scripts/firebase-auth.js';

const form = document.getElementById('admin-form');
const messageDiv = document.getElementById('message');

form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const email = document.getElementById('email').value.trim();
  const name = document.getElementById('name').value.trim();
  const password = document.getElementById('password').value;
  const passwordConfirm = document.getElementById('password-confirm').value;

  // Validaciones
  if (password !== passwordConfirm) {
    showMessage('Las contrase√±as no coinciden', 'error');
    return;
  }

  if (password.length < 6) {
    showMessage('La contrase√±a debe tener al menos 6 caracteres', 'error');
    return;
  }

  if (!email || !name) {
    showMessage('Por favor completa todos los campos', 'error');
    return;
  }

  try {
    // Mostrar loading
    const button = form.querySelector('button[type="submit"]');
    button.disabled = true;
    button.innerHTML = '<span class="material-icons animate-spin">pending</span> Creando...';

    // Crear admin
    const userId = await createInitialAdmin(email, password, name);

    showMessage(
      `‚úÖ ¬°√âxito! Admin creado. ID: ${userId}\n\nAhora ve a /login_and_registration/login.html`,
      'success'
    );

    // Limpiar formulario
    form.reset();
    
    // Redirigir en 3 segundos
    setTimeout(() => {
      window.location.href = '/login_and_registration/login.html';
    }, 3000);

  } catch (error) {
    console.error('Error:', error);
    
    let mensaje = 'Error desconocido';
    if (error.code === 'auth/email-already-in-use') {
      mensaje = 'Este correo ya est√° registrado';
    } else if (error.code === 'auth/weak-password') {
      mensaje = 'Contrase√±a muy d√©bil. Usa al menos 6 caracteres';
    } else if (error.code === 'auth/invalid-email') {
      mensaje = 'Correo invalido';
    } else if (error.message) {
      mensaje = error.message;
    }

    showMessage(mensaje, 'error');
    
    // Re-habilitar bot√≥n
    const button = form.querySelector('button[type="submit"]');
    button.disabled = false;
    button.innerHTML = '<span class="material-icons">person_add</span> Crear Admin';
  }
});

function showMessage(text, type) {
  messageDiv.className = `p-4 rounded-lg ${
    type === 'success' 
      ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400' 
      : 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400'
  } text-sm font-medium`;
  messageDiv.innerHTML = text.replace(/\n/g, '<br/>');
  messageDiv.classList.remove('hidden');
}
</script>

<style>
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  .animate-spin {
    animation: spin 1s linear infinite;
  }
</style>

</body>
</html>
